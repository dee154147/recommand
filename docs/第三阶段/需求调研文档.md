# 第三阶段需求调研文档

## 文档信息
- **创建时间**: 2024年12月20日
- **阶段**: 第三阶段 - 用户交互模块
- **状态**: 需求确认完成
- **负责人**: 开发团队

---

## 1. 项目背景

### 1.1 当前状态
第二阶段已完成数据处理和智能检索功能，包括：
- ✅ 商品数据处理和标签提取
- ✅ 推荐算法实现（向量计算和存储）
- ✅ 商品检索功能（语义检索和模糊匹配）
- ✅ 相似商品查询功能
- ✅ 完整的API接口体系

### 1.2 第三阶段目标
实现用户交互模块，模拟用户与推荐系统的交互行为，收集用户行为数据，实现个性化推荐功能。

---

## 2. 需求调研过程

### 2.1 初始需求提出
用户提出第三阶段开发需求，包含：
1. **用户交互模块** - 核心功能

### 2.2 需求调研问题
开发团队通过以下问题深入了解需求：

#### 2.2.1 前端风格要求
- **问题**: 关于前端风格有什么要求？
- **回答**: 希望整个系统保持一致的风格，在设计阶段，第一步先设计页面，并输出原型给我确认

#### 2.2.2 实现功能详细需求
- **问题**: 希望实现什么功能？
- **回答**: 
  - **2.1 用户交互行为模拟**
    - 通过这个模块，能模拟用户与推荐系统的交互
    - 包括用户点击、查看、收藏、购买、不推荐等行为
    - 每个行为都有对应的评分机制
    - 系统需要收集用户的所有交互，并生成对商品的评分
    - 该评分用于生成用户推荐列表
    - 用户的交互行为只需要通过各个按钮来实现就行了，比如点击按钮、购买按钮等
    - 不需要实现对应的逻辑，只需要记录这个交互以及计算对商品的评分

  - **2.2 用户身份管理**
    - 不需要实现用户注册、登录等功能
    - 在用户交互模块，通过输入用户id，来绑定当前用户信息
    - 如果不存在该id，则新增该用户
    - 输入后，真正进入交互页，就固定该用户进行交互
    - 同时提供退出功能，回退到输入用户id页面

  - **2.3 商品检索功能集成**
    - 用户交互页面要实现商品检索功能，类似于商品检索模块
    - 用户可以检索商品，同时还要针对用户的交互进行商品推荐
    - 并展示推荐商品列表
    - 该推荐的逻辑为：基于交互过的商品，通过评分，对商品向量进行加权平均，以此作为用户特征向量，并记录起来
    - 每次交互都更新特征向量
    - 然后页面上点刷新推荐列表时，通过用户特征向量与商品进行相似度运算，直接得到相似商品列表

  - **2.4 用户标签记录**
    - 用户交互过程中，还要将用户交互过的商品包含的标签记录起来
    - 标签的权重为用户对商品的评分
    - 仅做记录，以供后续用户画像功能的实现

  - **2.5 用户画像功能**
    - 用户画像功能在当前阶段不用实现

#### 2.2.3 技术要求
- **问题**: 有什么技术要求？
- **回答**:
  - **3.1 设计流程要求**
    - 在做设计时，第一步是设计原型，并需要获取我的确认
  - **3.2 系统兼容性要求**
    - 整个开发过程中，不能影响原有的功能
    - 更不能影响原有的商品向量运算、推荐系统核心算法逻辑

### 2.3 需求澄清过程

#### 2.3.1 冷启动方案澄清
- **开发团队理解**: 提出了冷启动方案，为新用户推荐热门商品
- **用户澄清**: 不需要冷启动方案，如果没有交互，则仅提示"暂无交互数据"，整个过程不需要造任何数据
- **核心原则**: 真实数据驱动，不造任何假数据，完全基于真实用户交互

#### 2.3.2 空状态处理澄清
- **用户要求**: 没有交互数据时，简单提示"暂无交互数据"
- **设计原则**: 保持系统的真实性和可信度
- **实现方式**: 空状态时显示友好提示，引导用户进行交互

---

## 3. 核心需求总结

### 3.1 用户身份管理

#### 需求描述
- **用户身份**: 通过输入用户ID来绑定用户，无需注册登录
- **用户创建**: 如果用户ID不存在，则自动创建新用户
- **用户切换**: 提供退出功能，回退到用户ID输入页面

#### 具体功能
1. **用户ID输入页面**
   - 简洁的输入界面，与系统风格保持一致
   - 输入验证和错误提示
   - 进入交互页面的按钮

2. **用户信息管理**
   - 自动创建新用户记录
   - 用户状态持久化
   - 用户会话管理

#### 技术要求
- 前端使用Vue.js，保持现有风格
- 后端使用Flask，集成现有API体系
- 数据库使用PostgreSQL，扩展用户表结构

### 3.2 用户交互行为

#### 需求描述
实现用户与商品的交互行为，包括点击、查看、收藏、购买、不推荐等操作，每个行为对应不同的评分机制。

#### 具体功能
1. **交互行为类型**
   - **点击**: 基础交互，评分 +1
   - **查看**: 详细查看，评分 +2
   - **收藏**: 收藏商品，评分 +3
   - **购买**: 购买商品，评分 +5
   - **不推荐**: 负面反馈，评分 -2

2. **交互记录**
   - 记录用户ID、商品ID、行为类型、时间戳
   - 计算用户对商品的综合评分
   - 更新用户行为统计

3. **交互界面**
   - 每个商品卡片包含交互按钮
   - 按钮样式与现有风格保持一致
   - 交互反馈和状态显示

#### 技术要求
- 实时记录用户交互行为
- 支持批量交互操作
- 提供交互历史查询

### 3.3 商品检索功能集成

#### 需求描述
在用户交互页面集成商品检索功能，用户可以搜索商品并进行交互。

#### 具体功能
1. **搜索功能**
   - 复用现有的商品检索模块
   - 支持语义检索和模糊匹配
   - 搜索结果与交互功能结合

2. **搜索界面**
   - 保持与商品检索页面一致的风格
   - 集成到用户交互主页面
   - 响应式设计

#### 技术要求
- 复用现有检索API
- 保持界面风格一致性
- 优化用户体验

### 3.4 个性化推荐

#### 需求描述
基于用户交互历史，生成用户特征向量，实现个性化商品推荐。

#### 具体功能
1. **用户特征向量计算**
   - 基于用户交互过的商品向量进行加权平均
   - 权重为用户对商品的评分
   - 每次交互后更新用户特征向量

2. **推荐算法**
   - 使用用户特征向量与商品向量进行相似度计算
   - 返回相似度最高的商品列表
   - 支持推荐列表刷新

3. **推荐展示**
   - 推荐商品列表展示
   - 推荐理由说明
   - 推荐质量评估

#### 技术要求
- 实时更新用户特征向量
- 高效的相似度计算
- 支持推荐列表刷新

### 3.5 用户标签记录

#### 需求描述
记录用户交互商品的标签信息，为后续用户画像功能做准备。

#### 具体功能
1. **标签权重计算**
   - 标签权重 = 用户对商品的评分
   - 累计用户对每个标签的权重
   - 生成用户标签偏好

2. **标签存储**
   - 存储用户标签偏好数据
   - 支持标签权重查询
   - 为后续用户画像提供数据基础

#### 技术要求
- 高效存储用户标签数据
- 支持标签权重统计
- 为后续功能预留接口

### 3.6 空状态处理

#### 需求描述
当用户没有交互数据时，系统需要优雅地处理空状态。

#### 具体功能
1. **空状态提示**
   - 显示"暂无交互数据"提示
   - 引导用户进行商品交互
   - 提供搜索功能入口

2. **数据验证**
   - 每次推荐前检查用户是否有交互数据
   - 没有数据时返回空结果
   - 前端显示友好提示信息

#### 技术要求
- 不造任何假数据
- 保持系统真实性
- 提供友好的用户引导

---

## 4. 技术架构

### 4.1 用户交互流程
```
用户ID输入 → 用户验证/创建 → 交互页面 → 商品检索 → 用户交互 → 特征向量更新 → 个性化推荐
```

### 4.2 推荐算法流程
```
用户交互 → 商品评分 → 加权平均 → 用户特征向量 → 相似度计算 → 推荐列表
```

### 4.3 数据存储流程
```
用户交互 → 行为记录 → 标签权重 → 特征向量 → 数据库存储
```

### 4.4 空状态处理流程
```
用户进入 → 检查交互数据 → 无数据：显示提示 → 有数据：显示推荐
```

---

## 5. 数据库设计

### 5.1 用户表 (users)
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 用户交互表 (user_interactions)
```sql
CREATE TABLE user_interactions (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    product_id INTEGER NOT NULL,
    interaction_type VARCHAR(20) NOT NULL, -- click, view, favorite, purchase, dislike
    score INTEGER NOT NULL, -- 交互评分
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

### 5.3 用户特征向量表 (user_vectors)
```sql
CREATE TABLE user_vectors (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) UNIQUE NOT NULL,
    vector VECTOR(384), -- 用户特征向量
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

### 5.4 用户标签偏好表 (user_tag_preferences)
```sql
CREATE TABLE user_tag_preferences (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    tag VARCHAR(100) NOT NULL,
    total_score DECIMAL(10,2) DEFAULT 0, -- 累计评分
    interaction_count INTEGER DEFAULT 0, -- 交互次数
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    UNIQUE(user_id, tag)
);
```

---

## 6. API接口设计

### 6.1 用户管理接口
```python
# 用户登录/创建
POST /api/v1/user/login
Body: {
    "user_id": "user123"
}

# 用户退出
POST /api/v1/user/logout
Body: {
    "user_id": "user123"
}

# 获取用户信息
GET /api/v1/user/{user_id}
```

### 6.2 用户交互接口
```python
# 记录用户交互
POST /api/v1/user/interaction
Body: {
    "user_id": "user123",
    "product_id": 1,
    "interaction_type": "click"
}

# 获取用户交互历史
GET /api/v1/user/{user_id}/interactions
```

### 6.3 个性化推荐接口
```python
# 获取个性化推荐
GET /api/v1/user/{user_id}/recommendations
Query: {
    "limit": 20,
    "refresh": true
}

# 更新用户特征向量
POST /api/v1/user/{user_id}/update-vector
```

### 6.4 用户标签接口
```python
# 获取用户标签偏好
GET /api/v1/user/{user_id}/tag-preferences

# 更新用户标签偏好
POST /api/v1/user/{user_id}/update-tags
```

---

## 7. 前端页面设计

### 7.1 用户ID输入页面
```
┌─────────────────────────────────────────┐
│                导航栏                    │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │        用户交互系统              │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │        请输入用户ID              │   │
│  │  ┌─────────────────────────┐   │   │
│  │  │                         │   │   │
│  │  └─────────────────────────┘   │   │
│  │  ┌─────────┐  ┌─────────┐     │   │
│  │  │  进入   │  │  取消   │     │   │
│  │  └─────────┘  └─────────┘     │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 7.2 用户交互主页面（空状态）
```
┌─────────────────────────────────────────┐
│                导航栏                    │
├─────────────────────────────────────────┤
│ 用户: user123  ┌─────────┐ ┌─────────┐ │
│                │  搜索   │ │  推荐   │ │
│                └─────────┘ └─────────┘ │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │        搜索栏                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │        暂无交互数据              │   │
│  │                                 │   │
│  │  请先搜索商品并进行交互          │   │
│  │  以获取个性化推荐                │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 7.3 用户交互主页面（有数据状态）
```
┌─────────────────────────────────────────┐
│                导航栏                    │
├─────────────────────────────────────────┤
│ 用户: user123 (已交互: 15次)             │
│                ┌─────────┐ ┌─────────┐ │
│                │  搜索   │ │  推荐   │ │
│                └─────────┘ └─────────┘ │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │        搜索栏                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品1│ │商品2│ │商品3│ │商品4│ │商品5│ │
│  │[点击]│ │[查看]│ │[收藏]│ │[购买]│ │[不推荐]││
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品6│ │商品7│ │商品8│ │商品9│ │商品10││
│  │[点击]│ │[查看]│ │[收藏]│ │[购买]│ │[不推荐]││
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │        个性化推荐                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │推荐1│ │推荐2│ │推荐3│ │推荐4│ │推荐5│ │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │          分页条                 │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

### 7.4 设计风格要求
- **科技风格**: 与现有系统保持一致的渐变背景和玻璃拟态效果
- **交互按钮**: 不同行为类型使用不同颜色和样式
- **响应式设计**: 支持移动端和桌面端访问
- **状态反馈**: 交互操作后提供即时反馈
- **空状态设计**: 友好的无数据提示和引导

---

## 8. 开发计划

### 8.1 开发阶段
1. **第一阶段**: 需求调研与原型设计 ✅
2. **第二阶段**: 数据库设计
3. **第三阶段**: 后端API开发
4. **第四阶段**: 前端开发
5. **第五阶段**: 测试与文档

### 8.2 时间安排
- **总开发时间**: 预计2-3周
- **需求调研**: 1-2天 ✅
- **数据库设计**: 1-2天
- **后端开发**: 4-5天
- **前端开发**: 4-5天
- **测试文档**: 2-3天

---

## 9. 验收标准

### 9.1 功能验收
- ✅ 用户ID输入和验证功能正常
- ✅ 用户交互行为记录准确
- ✅ 个性化推荐算法正确
- ✅ 用户特征向量计算准确
- ✅ 商品检索功能集成正常
- ✅ 用户标签记录完整
- ✅ 空状态处理友好

### 9.2 性能验收
- ✅ 用户交互响应时间 < 200ms
- ✅ 推荐计算时间 < 1秒
- ✅ 支持1000+用户并发
- ✅ 数据存储和查询高效

### 9.3 界面验收
- ✅ 页面风格与现有系统一致
- ✅ 响应式设计正常
- ✅ 交互效果流畅
- ✅ 用户体验良好
- ✅ 空状态设计友好

---

## 10. 风险控制

### 10.1 技术风险
- **向量计算性能**: 优化用户特征向量计算算法
- **数据库性能**: 合理设计索引，优化查询性能
- **并发处理**: 确保多用户同时交互的稳定性

### 10.2 数据风险
- **数据一致性**: 确保用户交互数据的一致性
- **数据备份**: 重要用户数据及时备份
- **数据安全**: 保护用户隐私数据
- **数据真实性**: 不造任何假数据，保持系统可信度

### 10.3 开发风险
- **进度控制**: 按阶段开发，及时调整计划
- **质量保证**: 每个功能完成后进行测试
- **文档更新**: 及时更新技术文档
- **原型确认**: 确保原型设计符合用户要求

---

## 11. 后续规划

### 11.1 第四阶段
- 用户画像功能实现
- 推荐算法优化
- 数据分析功能

### 11.2 第五阶段
- 性能优化
- 系统监控
- 部署优化

---

## 12. 总结

第三阶段的核心目标是实现用户交互模块，通过模拟用户与推荐系统的交互行为，收集用户行为数据，实现个性化推荐功能。

**关键成功因素**:
1. 准确理解用户交互需求
2. 合理设计用户行为评分机制
3. 高效实现个性化推荐算法
4. 保持界面风格一致性
5. 保证系统性能和稳定性
6. 保持数据真实性和可信度
7. 优雅处理空状态情况

**核心原则**:
- 真实数据驱动，不造任何假数据
- 保持系统真实性和可信度
- 空状态时提供友好提示和引导
- 不影响原有功能和核心算法

---

*本文档记录了第三阶段的核心需求，为后续开发提供明确指导。如有需求变更，请及时更新文档。*
