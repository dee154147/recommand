# å•†å“æ ‡ç­¾å‘é‡åŒ¹é…åŠŸèƒ½è°ƒè¯•å®Œæˆ

## æ—¶é—´
2025å¹´1æœˆ22æ—¥ 19:00

## é—®é¢˜æè¿°
ç”¨æˆ·å‘ç°å•†å“ç®¡ç†æ¨¡å—çš„ç›¸ä¼¼å•†å“æ£€ç´¢åŠŸèƒ½ä½¿ç”¨çš„æ˜¯å­—ç¬¦ä¸²æ¨¡ç³ŠåŒ¹é…ï¼ˆLIKEæ“ä½œç¬¦ï¼‰ï¼Œè€Œä¸æ˜¯åŸºäºè¯å‘é‡çš„ç›¸ä¼¼åº¦åŒ¹é…ã€‚ç”¨æˆ·è¦æ±‚å‚è€ƒå•†å“æ£€ç´¢æ¨¡å—çš„é€»è¾‘ï¼Œå®ç°åŸºäºæ ‡ç­¾å‘é‡çš„ç›¸ä¼¼å•†å“æ£€ç´¢ã€‚

## é—®é¢˜åˆ†æ

### åŸå§‹å®ç°ï¼ˆé”™è¯¯ï¼‰
- **åŒ¹é…æ–¹å¼**: å­—ç¬¦ä¸²æ¨¡ç³ŠåŒ¹é…
- **SQLæŸ¥è¯¢**: `tags LIKE '%æ ‡ç­¾%'`
- **ç›¸ä¼¼åº¦è®¡ç®—**: åŸºäºåŒ¹é…æ ‡ç­¾æ•°é‡
- **åŒ¹é…ç±»å‹**: `tag_keyword`
- **ç›¸ä¼¼åº¦**: 0.7å·¦å³ï¼ˆå›ºå®šå€¼ï¼‰

### ç›®æ ‡å®ç°ï¼ˆæ­£ç¡®ï¼‰
- **åŒ¹é…æ–¹å¼**: è¯å‘é‡ç›¸ä¼¼åº¦åŒ¹é…
- **ç‰¹å¾æå–**: ä½¿ç”¨è…¾è®¯AIå®éªŒå®¤ä¸­æ–‡è¯å‘é‡
- **æŸ¥è¯¢å‘é‡**: æ ‡ç­¾å‘é‡çš„åŠ æƒå¹³å‡
- **ç›¸ä¼¼åº¦è®¡ç®—**: ä½¿ç”¨pgvectorè¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
- **åŒ¹é…ç±»å‹**: `vector_similarity`
- **ç›¸ä¼¼åº¦**: 0.89-0.90ï¼ˆçœŸå®è®¡ç®—å€¼ï¼‰

## è§£å†³è¿‡ç¨‹

### 1. ä»£ç å®ç°
ä¿®æ”¹ `backend/app/api/product_management_routes.py`ï¼š

```python
def _find_similar_by_tag_vectors(tags: List[str], limit: int) -> List[Dict]:
    """
    åŸºäºæ ‡ç­¾å‘é‡æœç´¢ç›¸ä¼¼å•†å“
    """
    # 1. è·å–æ ‡ç­¾å‘é‡
    tag_vectors = []
    for tag in tags:
        vector = recommendation_service.get_word_vector(tag)
        if vector is not None:
            tag_vectors.append(vector)
    
    # 2. è®¡ç®—æŸ¥è¯¢å‘é‡ï¼ˆåŠ æƒå¹³å‡ï¼‰
    query_vector = np.mean(tag_vectors, axis=0)
    
    # 3. ä½¿ç”¨pgvectorè¿›è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢
    vector_str = '[' + ','.join(map(str, query_vector)) + ']'
    
    sql_query = text("""
        SELECT 
            id, name, description, price, category_id, image_url, tags,
            product_vector <=> :query_vector as distance,
            1 - (product_vector <=> :query_vector) as similarity
        FROM products 
        WHERE product_vector IS NOT NULL
        ORDER BY product_vector <=> :query_vector
        LIMIT :limit
    """)
    
    # 4. è¿”å›ç»“æœ
    return products
```

### 2. è°ƒè¯•è¿‡ç¨‹
è°ƒè¯•å‘ç°äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š**æ—§çš„Flaskè¿›ç¨‹æ²¡æœ‰åŠ è½½æ–°ä»£ç **

- **ç°è±¡**: å‡½æ•°æµ‹è¯•æ­£å¸¸ï¼ŒAPIè°ƒç”¨è¿”å›é”™è¯¯ç»“æœ
- **åŸå› **: åå°è¿è¡Œçš„Flaskè¿›ç¨‹æ˜¯æ—§ç‰ˆæœ¬ä»£ç 
- **è§£å†³**: é‡å¯FlaskæœåŠ¡åŠ è½½æ–°ä»£ç 

### 3. æµ‹è¯•éªŒè¯

#### åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•å‘é‡åŒ¹é…åŠŸèƒ½
curl -X POST "http://localhost:5004/api/v1/product-management/find-similar-by-tags" \
  -H "Content-Type: application/json" \
  -d '{"tags": ["ç”·è£…", "å•†åŠ¡"], "limit": 3}'
```

#### ç»“æœå¯¹æ¯”
**ä¿®å¤å‰ï¼ˆå­—ç¬¦ä¸²åŒ¹é…ï¼‰**:
- åŒ¹é…ç±»å‹: `tag_keyword`
- ç›¸ä¼¼åº¦: 0.7ï¼ˆå›ºå®šå€¼ï¼‰
- å•†å“è´¨é‡: ä¸€èˆ¬

**ä¿®å¤åï¼ˆå‘é‡åŒ¹é…ï¼‰**:
- åŒ¹é…ç±»å‹: `vector_similarity`
- ç›¸ä¼¼åº¦: 0.9014, 0.8965, 0.8929
- å•†å“è´¨é‡: é«˜åº¦ç›¸å…³

## æœ€ç»ˆç»“æœ

### âœ… æˆåŠŸå®ç°åŸºäºè¯å‘é‡çš„ç›¸ä¼¼å•†å“æ£€ç´¢
1. **ç‰¹å¾æå–**: ä½¿ç”¨è…¾è®¯AIå®éªŒå®¤ä¸­æ–‡è¯å‘é‡æ¨¡å‹
2. **å‘é‡è®¡ç®—**: æ ‡ç­¾å‘é‡åŠ æƒå¹³å‡ç”ŸæˆæŸ¥è¯¢å‘é‡
3. **ç›¸ä¼¼åº¦åŒ¹é…**: ä½¿ç”¨pgvectorè¿›è¡Œé«˜æ•ˆå‘é‡ç›¸ä¼¼åº¦è®¡ç®—
4. **ç»“æœè´¨é‡**: ç›¸ä¼¼åº¦è¾¾åˆ°0.89-0.90ï¼Œå•†å“é«˜åº¦ç›¸å…³

### ğŸ“Š æ€§èƒ½ä¼˜åŠ¿
- **å‡†ç¡®æ€§**: ä»å›ºå®š0.7æå‡åˆ°çœŸå®è®¡ç®—çš„0.89-0.90
- **ç›¸å…³æ€§**: æ‰¾åˆ°çš„å•†å“è¯­ä¹‰ç›¸å…³æ€§æ›´å¼º
- **å¯æ‰©å±•æ€§**: æ”¯æŒæ›´å¤æ‚çš„å‘é‡è®¡ç®—ç­–ç•¥

### ğŸ”§ æŠ€æœ¯è¦ç‚¹
- **è¯å‘é‡æ¨¡å‹**: Tencent_AILab_ChineseEmbedding.bin
- **å‘é‡ç»´åº¦**: 200ç»´
- **æ•°æ®åº“æ‰©å±•**: pgvector
- **ç›¸ä¼¼åº¦ç®—æ³•**: ä½™å¼¦ç›¸ä¼¼åº¦
- **é™çº§ç­–ç•¥**: å‘é‡åŒ¹é…å¤±è´¥æ—¶é™çº§åˆ°å…³é”®è¯åŒ¹é…

## æ–‡ä»¶å˜æ›´
- `backend/app/api/product_management_routes.py`: æ–°å¢å‘é‡åŒ¹é…å‡½æ•°
- åˆ é™¤ä¸´æ—¶è°ƒè¯•æ–‡ä»¶

## éªŒè¯å‘½ä»¤
```bash
# éªŒè¯å‘é‡åŒ¹é…åŠŸèƒ½
curl -s -X POST "http://localhost:5004/api/v1/product-management/find-similar-by-tags" \
  -H "Content-Type: application/json" \
  -d '{"tags": ["ç”·è£…", "å•†åŠ¡"], "limit": 3}' | jq '.data.similar_products[0].match_type'
# é¢„æœŸè¾“å‡º: "vector_similarity"
```
