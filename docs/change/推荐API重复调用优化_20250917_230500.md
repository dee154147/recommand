# 推荐API重复调用优化

## 修改时间
2025-09-17 23:05:00

## 问题描述
用户反馈页面有重复的个性化推荐区域，通过检查发现：
1. 推荐API被多次调用（从终端日志可以看到多次GET请求）
2. `updateRecommendations`函数在多个地方被调用，导致重复请求
3. 可能造成页面显示异常或性能问题

## 问题分析

### 重复调用位置
1. **页面加载时**：`loadUserInteractions`中调用
2. **用户交互后**：`recordInteraction`中调用（延迟1秒）
3. **刷新推荐按钮**：`refreshRecommendations`中调用
4. **推荐按钮点击**：`scrollToRecommendations`中调用

### 调用时序问题
- 页面加载时立即调用
- 用户交互后1秒延迟调用
- 点击推荐按钮时立即调用
- 可能导致短时间内多次API请求

## 解决方案

### 1. 添加防重复调用机制
```javascript
const lastRecommendationUpdate = ref(0)

const updateRecommendations = async (force = false) => {
  // 防重复调用：如果距离上次更新不到2秒，且不是强制更新，则跳过
  const now = Date.now()
  if (!force && now - lastRecommendationUpdate.value < 2000) {
    console.log('跳过重复的推荐更新请求')
    return
  }
  
  lastRecommendationUpdate.value = now
  // ... 推荐更新逻辑
}
```

### 2. 强制更新机制
- 刷新推荐按钮使用`force = true`参数
- 确保用户主动刷新时能立即更新

### 3. 优化调用策略
- 页面加载时：正常调用
- 用户交互后：延迟调用（已有1秒延迟）
- 推荐按钮点击：防重复调用
- 刷新按钮：强制更新

## 修改文件
- `frontend/src/views/UserInteraction.vue`

## 预期效果
1. 减少不必要的API调用
2. 提升页面性能
3. 避免重复的推荐区域显示
4. 保持用户体验的流畅性

## 测试建议
1. 刷新页面，观察控制台日志
2. 快速点击推荐按钮多次，验证防重复机制
3. 进行商品交互，观察推荐更新时机
4. 点击刷新推荐按钮，验证强制更新功能
