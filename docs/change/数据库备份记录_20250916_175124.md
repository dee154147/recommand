# 数据库备份记录

## 备份信息

- **备份时间**: 2025年9月16日 17:49:45 CST
- **数据库名称**: recommendation_db
- **数据库类型**: PostgreSQL
- **数据库版本**: 14.19 (Homebrew)
- **备份工具版本**: pg_dump 15.14 (Homebrew)

## 备份文件详情

### SQL格式备份
- **文件名**: `recommendation_db_backup_20250916_174945.sql`
- **文件大小**: 413MB (432,868,382 字节)
- **格式**: 纯文本SQL格式
- **用途**: 可读性强，便于查看和编辑，跨版本兼容性好

### 自定义格式备份
- **文件名**: `recommendation_db_backup_20250916_174945.dump`
- **文件大小**: 168MB (176,392,749 字节)
- **格式**: PostgreSQL自定义二进制格式
- **压缩级别**: 9 (最高压缩)
- **用途**: 压缩率高，恢复速度快，支持选择性恢复

## 数据库结构统计

### 表结构
- **总表数**: 7个
- **表列表**:
  1. categories (商品分类表)
  2. product_tags (商品标签表)
  3. products (商品表)
  4. recommendation_cache (推荐缓存表)
  5. tag_vectors (标签向量表)
  6. user_interactions (用户交互表)
  7. users (用户表)

### 备份内容统计
- **TOC条目数**: 91个
- **包含内容**:
  - 数据库架构和扩展
  - 表结构和约束
  - 索引定义
  - 数据内容
  - 序列和默认值
  - 外键关系
  - 访问权限

## 备份脚本

创建了自动化备份脚本 `backup_database.sh`，包含以下功能：

1. **双格式备份**: 同时生成SQL和自定义格式备份
2. **自动时间戳**: 使用时间戳命名备份文件
3. **完整性验证**: 自动验证备份文件完整性
4. **旧文件清理**: 自动清理旧备份文件（保留最近10个）
5. **详细日志**: 提供详细的备份过程日志

## 备份位置

- **备份目录**: `/Users/liuzhichao/cursorProjects/recommand2/backups/`
- **总目录大小**: 1.2GB

## 验证结果

✅ **备份完整性验证通过**:
- SQL备份文件存在且不为空
- DUMP备份文件存在且不为空
- 文件头信息正确
- TOC条目完整

## 恢复方法

### 从SQL备份恢复
```bash
psql -h localhost -U liuzhichao -d target_database < recommendation_db_backup_20250916_174945.sql
```

### 从自定义格式备份恢复
```bash
pg_restore -h localhost -U liuzhichao -d target_database recommendation_db_backup_20250916_174945.dump
```

### 选择性恢复表
```bash
pg_restore -h localhost -U liuzhichao -d target_database -t table_name recommendation_db_backup_20250916_174945.dump
```

## 备份策略建议

1. **定期备份**: 建议每日自动备份
2. **异地存储**: 考虑将备份文件存储到云存储服务
3. **备份验证**: 定期测试备份文件的恢复功能
4. **监控告警**: 设置备份失败的监控告警

## 相关文件

- 备份脚本: `backup_database.sh`
- 数据库配置: `backend/config.py`
- Docker配置: `docker-compose.yml`

---

**备份完成时间**: 2025年9月16日 17:51:24 CST  
**操作人员**: AI助手  
**备份状态**: ✅ 成功完成
