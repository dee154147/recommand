# 第二阶段需求调研文档

## 文档信息
- **创建时间**: 2024年12月20日
- **阶段**: 第二阶段 - 数据处理与智能检索
- **状态**: 需求确认完成
- **负责人**: 开发团队

---

## 1. 项目背景

### 1.1 当前状态
第一阶段已完成基础架构搭建，包括：
- ✅ 完整的前后端分离架构
- ✅ 现代化的用户界面（Vue.js + Element Plus）
- ✅ 可扩展的后端框架（Flask + SQLAlchemy）
- ✅ 完善的文档体系
- ✅ 便捷的部署方案

### 1.2 第二阶段目标
将静态演示系统升级为具备数据处理和智能检索功能的系统，实现核心的推荐算法能力。

---

## 2. 核心需求

### 2.1 数据处理模块

#### 需求描述
- **数据源**: `data/product.txt` 文件中的商品原数据
- **处理目标**: 提取商品信息，生成商品标签，存储到数据库

#### 具体功能
1. **商品信息提取**
   - 从原始数据中解析商品ID、标题、图片链接等信息
   - 验证数据完整性和格式正确性

2. **商品标签生成**
   - 使用 jieba 分词对商品标题进行分词
   - 过滤停用词和无意义词汇
   - 生成商品标签列表

3. **数据库存储**
   - 将商品信息存储到 `products` 表
   - 将商品标签信息存储到相关表结构
   - 确保数据一致性和完整性

#### 技术要求
- 使用现有的 jieba 分词库
- 数据库使用 PostgreSQL + SQLAlchemy
- 支持批量数据处理
- 提供数据导入进度反馈

### 2.2 推荐算法实现

#### 需求描述
实现基于内容的推荐算法核心，包括向量计算和存储功能。

#### 具体功能
1. **标签向量预计算**
   - 使用腾讯词向量模型 (`model/Tencent_AILab_ChineseEmbedding.bin`)
   - 计算每个商品标签的向量表示
   - 缓存标签向量结果

2. **商品向量计算**
   - 通过商品标签向量进行加权平均
   - 生成商品特征向量
   - 支持向量归一化处理

3. **向量存储**
   - 使用 pgvector 扩展存储向量数据
   - 建立向量索引优化查询性能
   - 支持向量相似度计算

#### 技术要求
- 集成腾讯词向量模型
- 使用 pgvector 进行向量存储
- 实现高效的向量计算算法
- 支持向量相似度计算（余弦相似度）

### 2.3 商品检索模块

#### 需求描述
实现智能的商品检索功能，支持语义检索和模糊匹配两种检索方式。

#### 具体功能
1. **检索页面设计**
   - 简洁的页面布局，与首页保持一致的科技风格
   - 响应式设计，支持移动端访问
   - 现代化的UI组件和交互效果

2. **搜索功能**
   - **搜索栏**: 支持关键词输入
   - **语义检索按钮**: 基于向量相似度的智能检索
   - **模糊匹配检索按钮**: 基于文本匹配的传统检索

3. **结果展示**
   - 5×4 卡片式布局（每页20个商品）
   - 商品信息包括：图片、标题、价格、标签
   - 分页功能，包含分页条
   - 加载状态和空结果提示

4. **语义检索逻辑**
   - 对检索词进行 jieba 分词
   - 使用推荐算法计算检索词向量
   - 与商品向量进行相似度匹配
   - 按相似度排序返回分页结果

#### 技术要求
- 前端使用 Vue.js + Element Plus
- 保持与首页一致的科技风格
- 支持实时搜索和防抖处理
- 优化搜索性能和用户体验

---

## 3. 技术架构

### 3.1 数据处理流程
```
原始数据 → 数据解析 → jieba分词 → 标签生成 → 数据库存储
```

### 3.2 推荐算法流程
```
商品标签 → 词向量查询 → 标签向量 → 加权平均 → 商品向量 → 向量存储
```

### 3.3 检索系统流程
```
检索词 → jieba分词 → 词向量查询 → 检索向量 → 相似度计算 → 结果排序 → 分页返回
```

---

## 4. 数据库设计

### 4.1 商品表 (products)
```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2),
    image_url VARCHAR(500),
    tags TEXT,  -- JSON格式存储标签
    embedding VECTOR(384),  -- 商品特征向量
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 商品标签表 (product_tags)
```sql
CREATE TABLE product_tags (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES products(id),
    tag VARCHAR(100) NOT NULL,
    weight DECIMAL(5,4),  -- 标签权重
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4.3 标签向量表 (tag_vectors)
```sql
CREATE TABLE tag_vectors (
    id SERIAL PRIMARY KEY,
    tag VARCHAR(100) UNIQUE NOT NULL,
    vector VECTOR(384),  -- 标签向量
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 5. API接口设计

### 5.1 数据处理接口
```python
# 批量导入商品数据
POST /api/v1/data/import-products
Body: {
    "file_path": "data/product.txt",
    "batch_size": 100
}

# 获取导入进度
GET /api/v1/data/import-progress
```

### 5.2 推荐算法接口
```python
# 计算商品向量
POST /api/v1/recommendation/calculate-vectors
Body: {
    "product_ids": [1, 2, 3]
}

# 获取商品向量
GET /api/v1/recommendation/product-vector/{product_id}
```

### 5.3 检索接口
```python
# 语义检索
POST /api/v1/search/semantic
Body: {
    "query": "搜索关键词",
    "page": 1,
    "per_page": 20
}

# 模糊匹配检索
POST /api/v1/search/fuzzy
Body: {
    "query": "搜索关键词",
    "page": 1,
    "per_page": 20
}
```

---

## 6. 前端页面设计

### 6.1 检索页面布局
```
┌─────────────────────────────────────────┐
│                导航栏                    │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │        搜索栏                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────┐  ┌─────────┐              │
│  │语义检索 │  │模糊匹配 │              │
│  └─────────┘  └─────────┘              │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品1│ │商品2│ │商品3│ │商品4│ │商品5│ │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品6│ │商品7│ │商品8│ │商品9│ │商品10││
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品11││商品12││商品13││商品14││商品15││
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │
│  │商品16││商品17││商品18││商品19││商品20││
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │          分页条                 │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 6.2 设计风格要求
- **科技风格**: 与首页保持一致的渐变背景和玻璃拟态效果
- **简洁布局**: 突出搜索功能，减少干扰元素
- **响应式设计**: 支持移动端和桌面端访问
- **交互效果**: 悬停动画和加载状态提示

---

## 7. 开发计划

### 7.1 开发阶段
1. **第一阶段**: 数据处理模块开发
2. **第二阶段**: 推荐算法实现
3. **第三阶段**: 检索页面原型设计
4. **第四阶段**: 检索功能实现
5. **第五阶段**: 测试和优化

### 7.2 时间安排
- **总开发时间**: 预计2-3周
- **数据处理**: 3-4天
- **推荐算法**: 4-5天
- **检索页面**: 2-3天
- **检索功能**: 3-4天
- **测试优化**: 2-3天

---

## 8. 验收标准

### 8.1 功能验收
- ✅ 商品数据成功导入数据库
- ✅ 商品标签正确生成和存储
- ✅ 推荐算法准确计算商品向量
- ✅ 语义检索返回相关结果
- ✅ 模糊匹配检索正常工作
- ✅ 分页功能正常显示

### 8.2 性能验收
- ✅ 数据处理速度 > 100条/秒
- ✅ 向量计算时间 < 1秒/商品
- ✅ 检索响应时间 < 500ms
- ✅ 支持1000+商品数据

### 8.3 界面验收
- ✅ 页面风格与首页一致
- ✅ 响应式设计正常
- ✅ 交互效果流畅
- ✅ 用户体验良好

---

## 9. 风险控制

### 9.1 技术风险
- **词向量模型加载**: 确保模型文件完整性和加载性能
- **向量计算性能**: 优化算法性能，避免超时
- **数据库性能**: 合理设计索引，优化查询性能

### 9.2 数据风险
- **数据质量**: 验证原始数据格式和完整性
- **数据一致性**: 确保数据导入过程的一致性
- **数据备份**: 重要数据及时备份

### 9.3 开发风险
- **进度控制**: 按阶段开发，及时调整计划
- **质量保证**: 每个功能完成后进行测试
- **文档更新**: 及时更新技术文档

---

## 10. 后续规划

### 10.1 第三阶段
- 用户管理系统
- 推荐结果展示
- 用户行为分析

### 10.2 第四阶段
- 性能优化
- 系统监控
- 部署优化

---

## 11. 总结

第二阶段的核心目标是实现数据处理和智能检索功能，为推荐系统奠定技术基础。通过jieba分词、词向量计算和相似度匹配，实现智能的商品检索能力。

**关键成功因素**:
1. 准确理解业务需求
2. 合理设计技术架构
3. 高效实现核心算法
4. 优化用户体验
5. 保证系统性能

---

*本文档记录了第二阶段的核心需求，为后续开发提供明确指导。如有需求变更，请及时更新文档。*
